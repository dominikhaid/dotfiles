!function(){function e(e,t,n,i,o,s,r){try{var l=e[s](r),a=l.value}catch(e){return void n(e)}l.done?t(a):Promise.resolve(a).then(i,o)}function t(t){return function(){var n=this,i=arguments;return new Promise((function(o,s){var r=t.apply(n,i);function l(t){e(r,o,s,l,a,"next",t)}function a(t){e(r,o,s,l,a,"throw",t)}l(void 0)}))}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{exec(e,t){if(!e)throw"Cannot execute a check without an element";return t||(t=window.getComputedStyle(e)),this.callback(e,t)}constructor(e,t){if(n(this,"description",""),n(this,"callback",null),!e||!t)throw"Both a description and a callback are needed to create a new context check";this.description=e,this.callback=t}}const o=[new i("The element position has the value 'fixed' or 'sticky'",((e,t)=>"fixed"==t.position||"sticky"==t.position)),new i("The element has a z-index set and the position is not 'static'",((e,t)=>"static"!==t.position&&"auto"!==t.zIndex)),new i("The element has an opacity value smaller than 1",((e,t)=>{if("auto"==t.opacity)return!1;let n=parseFloat(t.opacity);return!isNaN(n)&&1!=n})),new i("The element has a non-default mix blend mode value",((e,t)=>"normal"!==t.mixBlendMode)),new i("The element has one of the following properties set: transform, filter, perspective, clip-path, mask, maskImage, maskBorder",((e,t)=>[t.transform,t.filter,t.perspective,t.clipPath,t.mask,t.maskImage,t.maskBorder].some((e=>void 0!==e&&"none"!==e)))),new i("The element has the isolation property set to 'isolate'",((e,t)=>"isolate"==t.isolation)),new i("The element has the webkit-overflow-scrolling property set to 'touch'",((e,t)=>"touch"==t.webkitOverflowScrolling)),new i("The element has a will-change value with a property that will create a context when its value is not the default one",((e,t)=>["mix-blend-mode","transform","filter","perspective","clip-path","mask","mask-image","mask-border"].some((e=>t.willChange.includes(e))))),new i("The element has a contain value that includes one of the following: layout, paint (or a composite value like 'strict' or 'content')",((e,t)=>["layout","paint","strict","content"].some((e=>t.contain.includes(e))))),new i("This element is a child of a flex container and has a z-index set",((e,t)=>{if(e.parentElement){if("flex"==window.getComputedStyle(e.parentElement).display&&"auto"!==t.zIndex)return!0}return!1})),new i("This element is a child of a grid container and has a z-index set",((e,t)=>{if(e.parentElement){if("grid"==window.getComputedStyle(e.parentElement).display&&"auto"!==t.zIndex)return!0}return!1}))];var s=class{addChild(e){this.children.push(e)}toJSON(){var e,t,n,i,o,s,r;let l=null!==(r=null===(e=this.parent)||void 0===e?void 0:e.id)&&void 0!==r?r:null,a=this.children.map((e=>e.id)),d=[];(null===(t=this.element)||void 0===t||null===(n=t.classList)||void 0===n?void 0:n.length)>0&&(d=[...this.element.classList]);let c=Array.from(document.getElementsByTagName("*")),h=this.element?c.indexOf(this.element):null,u=window.getComputedStyle(this.element);var p,f;let m={tagName:null!==(p=null===(i=this.element)||void 0===i||null===(o=i.tagName)||void 0===o?void 0:o.toLowerCase())&&void 0!==p?p:"document",id:null!==(f=null===(s=this.element)||void 0===s?void 0:s.id)&&void 0!==f?f:"",classes:d,index:h>=0?h:null,styles:{zIndex:u.zIndex,position:u.position}};return{id:this.id,parent:l,children:a,element:m,passedChecks:this.passedChecks,isInIframe:this.isInIframe}}constructor(e,t,i,o,s){let r=void 0===i?null:i,l=void 0===s?[]:s;n(this,"id",null),n(this,"parent",null),n(this,"children",[]),n(this,"element",null),n(this,"passedChecks",[]),this.element=e,this.isInIframe=null!=t&&t,this.frame=r,this.parent=null!=o?o:null,this.passedChecks=l}};var r=class extends s{toJSON(){var e;return{id:this.id,type:"container",name:this.name,children:this.children.map((e=>e.id)),parent:null===(e=this.parent)||void 0===e?void 0:e.id}}constructor(e,t,i,o,s){if(super(void 0===t?null:t,i,void 0===o?null:o,void 0===s?null:s),n(this,"name",""),n(this,"type","container"),!e)throw"The container must have a name";this.name=e}};let l=null;function a(e,t,n,i){let o=void 0!==n&&n,c=null,h=d(e);if(h.length>0){c=new s(e,o,i,t,h),t.addChild(c);let n=l.push(c);c.id=n-1,t=c}var u=!0,p=!1,f=void 0;try{for(var m,x=e.children[Symbol.iterator]();!(u=(m=x.next()).done);u=!0){let n=m.value;e.nodeType==Node.ELEMENT_NODE&&a(n,t,o,i)}}catch(e){p=!0,f=e}finally{try{u||null==x.return||x.return()}finally{if(p)throw f}}if(function(e){var t;return 0==e.children.length&&"IFRAME"===e.tagName&&(null===(t=e.contentDocument)||void 0===t?void 0:t.documentElement)}(e)){let n=e.contentDocument,i=new r("#document (iframe)",n.documentElement,o,e,t);t.addChild(i);let s=l.push(i);i.id=s-1,a(n.body,i,!0,e)}else if(function(e){var t;return"open"==(null===(t=e.shadowRoot)||void 0===t?void 0:t.mode)}(e)){let n=e.shadowRoot;var y=!0,g=!1,w=void 0;try{for(var v,b=n.children[Symbol.iterator]();!(y=(v=b.next()).done);y=!0){let n=v.value;e.nodeType==Node.ELEMENT_NODE&&a(n,t,!0,i)}}catch(e){g=!0,w=e}finally{try{y||null==b.return||b.return()}finally{if(g)throw w}}}}function d(e){let t=window.getComputedStyle(e),n=[];var i=!0,s=!1,r=void 0;try{for(var l,a=o[Symbol.iterator]();!(i=(l=a.next()).done);i=!0){let i=l.value;i.exec(e,t)&&n.push(i.description)}}catch(e){s=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}return n}var c={getPassedChecks:d,getContextsFromPage:function(){let e=new r("#document",document.documentElement,!1);return e.id=0,l=[e],a(document.body,e),[e,l]}};var h=class{constructor(){this.listeners=new Map}addListener(e,t){if("function"!=typeof t)throw"The callback must be a function";let n=this.listeners.get(e);n?n.push(t):this.listeners.set(e,[t])}removeListener(e,t){let n=this.listeners.get(e);if(!n)return;let i=n.indexOf(t);i<0||n.splice(i,1)}fireEvent(e,t={}){let n=this.listeners.get(e);if(n)for(let e of n)e(t)}};const u="bgscript-",p="bgscript.notab-",f="bootstrap",m="bootstrap-answer",x="request-id",y="get",g="set",w="call",v="answer",b="error";class C extends h{constructor(e,t={},n={}){super(),this.port=e,this.hasTabId=n.hasTabId??!0,this.proxy=null,this.waitingRequests=new Map,this.nextRequestId=1,this.RESTRICTED_NAMES=["then","$getMyTabId"],this.exposedMethods={},this.exposedProps={},this.remoteMethods=[],this.parseExposedData(t),this.port.onMessage.addListener((e=>this.handleMessage(e))),this.port.onDisconnect.addListener((()=>{this.fireEvent("disconnect")}))}parseExposedData(e){for(let[t,n]of Object.entries(e))this.RESTRICTED_NAMES.includes(t)?console.warn(`'${t}' is a restricted property name and will be ignored.`):"function"==typeof n?this.exposedMethods[t]=n:this.exposedProps[t]=n}initConnection(e){let t={type:f,exposedMethods:Object.keys(this.exposedMethods)};this._sendMessage(t,e)}getProxy(){return new Promise(((e,t)=>{if(this.proxy)return e(this.proxy);this.initConnection(e)}))}disconnect(){this.port.disconnect()}receivedBootstrapInfo(e){this.remoteMethods=e,this.initProxy()}handleMessage(e){let t=this.handleMessageTypes(e);t&&this.port.postMessage(t)}handleMessageTypes(e){let t;switch(e.type){case f:return this.receivedBootstrapInfo(e.exposedMethods),{type:m,id:e.id,exposedMethods:Object.keys(this.exposedMethods)};case m:return this.receivedBootstrapInfo(e.exposedMethods),t=this.getRequestCallback(e.id),t(this.proxy),null;case x:return{type:v,id:e.id,result:this.port.sender?.tab?.id??null};case y:return{type:v,id:e.id,result:this.exposedProps[e.prop]};case g:let n={type:v,id:e.id,result:void 0};return e.prop in this.exposedProps&&(n.result=this.exposedProps[e.prop]=e.value),n;case w:return!e.name in this.exposedMethods?{type:v,id:e.id,result:void 0}:(this._promisify(this.exposedMethods[e.name],e.args).then((t=>this.sendCallResult(e.id,t))).catch((t=>{console.error(t),this.sendCallError(e.id,t)})),null);case v:return t=this.getRequestCallback(e.id),t(e.result),null;case b:throw e.error}}sendCallResult(e,t){let n={type:v,id:e,result:t};return this.port.postMessage(n)}sendCallError(e,t){let n={type:b,id:e,error:t};return this.port.postMessage(n)}initProxy(){return this.proxy=new Proxy({},{get:(e,t)=>this.getTrap(e,t),set:(e,t,n)=>this.setTrap(e,t,n)}),this.proxy}getTrap(e,t){if("then"!==t)return"$getMyTabId"===t?()=>new Promise(((e,t)=>{if(!this.hasTabId)return e(null);let n={type:x};this._sendMessage(n,e)})):this._hasMethod(t)?(...e)=>new Promise(((n,i)=>{let o={type:w,name:t,args:e};this._sendMessage(o,n)})):new Promise(((e,n)=>{let i={type:y,prop:t};this._sendMessage(i,e)}))}setTrap(e,t,n){return new Promise(((e,i)=>{let o={type:g,prop:t,value:n};this._sendMessage(o,e)}))}getNewRequestId(){let e=this.nextRequestId;return this.nextRequestId++,e}getRequestCallback(e){return this.waitingRequests.get(e)}registerCallback(e,t){this.waitingRequests.set(e,t)}_hasMethod(e){return this.remoteMethods.findIndex((t=>t===e))>=0}_sendMessage(e,t){let n=this.getNewRequestId();e.id=n,this.registerCallback(n,t),this.port.postMessage(e)}_promisify(e,t){let n=null;try{n=e(...t)}catch(e){return new Promise(((t,n)=>n(e)))}return"object"==typeof n&&"then"in n?n:new Promise((e=>e(n)))}}class k{constructor(e,t){this.id=e,this.getTextCallback=t}getText(...e){return this.getTextCallback(...e)}}new k("ID_TAKEN",(e=>`The id '${e}' has already been taken. It must be unique.`)),new k("NO_CONNECTION",((e,t)=>`There is no connection assigned to id '${e}'${t?` connected to the tab ${t}`:""}.`));const I=class extends h{constructor(e,t={},n={context:"content"}){super(),this.scriptId=e??this._uuidv4(),this.connection=null,this.exposedData=t,this.context=n.context??"content",this.connectBackgroundScript()}connectBackgroundScript(){let e="";switch(this.context){case"content":e=u+this.scriptId;break;case"devtools":if(!chrome.devtools)throw"Cannot set context='devtools' when the script is not in a devtools window.";e=p+this.scriptId+"-"+chrome.devtools.inspectedWindow.tabId;break;case"tab-agnostic":e=this.scriptId}let t=chrome.runtime.connect({name:e});this.connection=new C(t,this.exposedData),this.connection.addListener("disconnect",(()=>{this.disconnectBackgroundScript()})),window.addEventListener("beforeunload",(()=>{this.disconnectBackgroundScript()})),this.fireEvent("connected",{})}disconnectBackgroundScript(){this.connection&&this.connection.disconnect(),this.connection=null,this.fireEvent("disconnected",{})}async getConnection(){return this.connection||this.connectBackgroundScript(),await this.connection.getProxy()}_uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}};var T=null,M=function(){let e=document.createElement("div");return e.id="devtools-stacking-context-highlight",e.style.backgroundColor="rgba(0,200,255, 0.7)",e.style.position="fixed",e.style.zIndex="2147483647",e.style.display="none",e}(),E=null,N=null,S=!1;function P(){return(P=t((function*(){var e;e=c.getContextsFromPage(),e[0],T=e[1]}))).apply(this,arguments)}function R(){S?(N.disconnect(),S=!1):console.warn("Tried stopping the observer, but it was already stopped.")}function O(e){if("childList"===e.type)return!0;if("attributes"===e.type){if(["style","class","id"].includes(e.attributeName))return!0;if(e.attributeName.startsWith("data-"))return!0}return!1}function D(e){if("devtools-stacking-context-highlight"==e.target.id)return!0;if("childList"==e.type){let t=null;if(1==e.addedNodes.length?t=e.addedNodes[0]:1==e.removedNodes.length&&(t=e.removedNodes[0]),"devtools-stacking-context-highlight"==(null==t?void 0:t.id))return!0}return!1}function _(){return(_=t((function*(){let e=yield L.getConnection();if(null==e)return;let t=yield e.$getMyTabId();yield e.sendDOMChangedWarning(t)}))).apply(this,arguments)}!function(){let e=(new Date).getTime();N=new MutationObserver(((t,n)=>{let i=(new Date).getTime();i-e<1e3||t.some(O)&&(t.every(D)||(e=i,function(){_.apply(this,arguments)}()))}))}();let B="content";window.top!==window.self&&(B+="."+window.location.href);var L=new I(B,{analysePage:function(){return P.apply(this,arguments)},getAllContextsJSON:function(){return T.map((e=>e.toJSON()))},highlightContext:function(e){let t=T[e].element.getBoundingClientRect(),n=function(e){let t={top:0,left:0},n=e;for(;n&&null!=n.frame;){if("container"===n.type){let e=n.frame.getBoundingClientRect();t.top+=e.top,t.left+=e.left}n=n.parent}return t}(T[e]);M.style.top=t.top+n.top+"px",M.style.left=t.left+n.left+"px",M.style.width=t.width+"px",M.style.height=t.height+"px",M.style.display="block",document.body.appendChild(M)},undoHighlightContext:function(){M.style.display="none",document.body.removeChild(M)},scrollToContext:function(e){T[e].element.scrollIntoView()},getPathFromContext:function(e){return function(e){let t=e,n=[],i=null;do{i=t.getRootNode();let e={index:Array.from(i.querySelectorAll("*")).findIndex((e=>e===t)),type:"document"};if(i instanceof ShadowRoot){if(e.type="shadow","closed"===i.mode)return null;t=i.host}else i!==document&&(e.type="iframe",t=i.defaultView.frameElement);n.push(e)}while(i!==document);return n.reverse()}(T.find((t=>t.id==e)).element)},detectLastInspectedElement:function(e){let t=null;try{t=function(e){let t=null;const n=(e,t)=>e.querySelectorAll("*")[t];var i=!0,o=!1,s=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){let e=r.value;switch(e.type){case"document":t=n(document,e.index);break;case"shadow":t=n(t.shadowRoot,e.index);break;case"iframe":t=n(t.contentDocument,e.index)}}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return t}(e)}catch(e){t=null}if(!t)throw"Cannot find element";E=t},getInspectedElementDetails:function(){let e={createsContext:!1,contextId:0,zIndex:"auto"};c.getPassedChecks(E).length>0&&(e.createsContext=!0);let t=function(e){let t=e;for(;null!==t;){if(foundContext=T.find((e=>e.element===t)),foundContext)return foundContext;if(null===t.parentElement){let e=t.getRootNode();if(e instanceof ShadowRoot){t=e.host;continue}}t=t.parentElement}return null}(E);e.contextId=t.id;let n=window.getComputedStyle(E);return e.zIndex=n.zIndex,e},getPageFramesSources:function(){let e=Array.from(document.getElementsByTagName("iframe")).map((e=>e.src));return e=e.filter((e=>""!==e)),e=[...new Set(e)],e},startDOMObserver:function(){if(S)return void console.warn("Tried starting the observer, but it was already running.");const e=document.body;N.observe(e,{attributes:!0,childList:!0,subtree:!0}),S=!0,window.addEventListener("beforeunload",R)},stopDOMObserver:function(){R(),window.removeEventListener("beforeunload",R)}})}();
//# sourceMappingURL=content.js.map
